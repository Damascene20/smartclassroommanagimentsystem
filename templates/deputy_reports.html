<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Deputy Reports - Teacher Documents</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Compact table */
        table { font-size: 0.85rem; }
        th, td { padding: 0.35rem; }

        /* Status colors */
        .table-status-approved { background-color: #d4edda; } /* green */
        .table-status-denied   { background-color: #f8d7da; } /* red */
        .table-status-pending  { background-color: #fff3cd; } /* orange */

        /* Smaller chart container */
        .chart-container { max-width: 400px; margin: 20px auto; }
    </style>
</head>
<body class="bg-light">
<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>ðŸ“Š Teacher Documents Reports</h4>
        <a href="{{ url_for('deputy_dashboard') }}" class="btn btn-secondary btn-sm">â¬… Dashboard</a>
    </div>

    <!-- Table on top -->
    <div class="table-responsive mb-4">
        <table class="table table-bordered table-striped shadow-sm text-center">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Status</th>
                    <th>Count</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
            {% for item in report_data %}
                <tr class="
                    {% if item.status == 'Approved' %}table-status-approved
                    {% elif item.status == 'Denied' %}table-status-denied
                    {% else %}table-status-pending{% endif %}">
                    <td>{{ loop.index }}</td>
                    <td>{{ item.status }}</td>
                    <td>{{ item.count }}</td>
                    <td>{{ item.percentage }}%</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Compact Chart -->
    <div class="chart-container">
        <canvas id="statusChart"></canvas>
    </div>

</div>

<script>
    const reportData = {{ report_data|tojson }};
    const labels = reportData.map(d => d.status);
    const counts = reportData.map(d => d.count);

    const ctx = document.getElementById('statusChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: counts,
                backgroundColor: reportData.map(d => {
                    if (d.status === 'Approved') return '#4CAF50'; // green
                    if (d.status === 'Denied') return '#F44336';   // red
                    if (d.status === 'Pending') return '#FF9800';  // orange
                    return '#9E9E9E'; // fallback grey
                }),
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom', labels: { font: { size: 10 } } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const percentage = reportData[context.dataIndex].percentage;
                            return context.label + ': ' + context.parsed + ' (' + percentage + '%)';
                        }
                    }
                }
            }
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
